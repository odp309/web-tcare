<div class="flex flex-col gap-[30px]">
  <app-page-header text="Dashboard">
    @if (name !== '') {
    <div class="flex items-center gap-2">
      <p class="text-green500Primary font-semibold">{{ name }}</p>
      <lucide-icon
        name="circle-user-round"
        size="32"
        color="#006885"
      ></lucide-icon>
    </div>
    }
  </app-page-header>
  <div class="flex justify-between items-center mt-[15px]">
    <button
      class="text-green500Primary font-medium border border-bluePrimary px-4 rounded-xl text-sm"
      (click)="onHandleFilterBtn(filterEntity)"
    >
      Refresh Data
    </button>
    <div class="flex justify-end">
      @for (item of arrFilterBy;let idx = $index; track idx) {
      <button
        [class]="
          filterEntity === item
            ? 'w-[90px] h-[26px] border border-[#DBDCDE] text-sm text-white font-medium bg-[#0092BB]'
            : 'w-[90px] h-[26px] rounded-none border border-[#DBDCDE] text-gray-400 text-sm'
        "
        [ngClass]="
          idx === 0
            ? 'rounded-l-xl rounded-r-none'
            : idx === 1
            ? 'rounded-none'
            : 'rounded-r-xl rounded-l-none'
        "
        (click)="onHandleFilterBtn(item)"
      >
        @switch (item) { @case ('personal') {
        {{ item | toTitleCase }}
        } @case ('division') { Divisi } @case ('all') { Semua } }
      </button>
      }
    </div>
  </div>
  @if ((isLoading$ | async) && isFetchDashboardCard) {
  <div class="flex justify-center w-full">
    <app-loading />
  </div>
  } @if (data.reopened && data.sla_performance && data.sla_completed) { @if
  (filterEntity === 'personal') {
  <div
    class="flex w-full flex-wrap gap-4 justify-center xl:flex-nowrap xl:justify-between"
  >
    <app-card customClass="bg-card1 w-[260px] h-[237px] p-[25px]">
      <div class="h-[25%]">
        <h4 class="text-white font-semibold text-lg">
          % Laporan Dibuka Kembali
        </h4>
      </div>
      <div class="h-[75%] flex justify-end">
        <div class="flex justify-end items-end">
          <p class="text-end text-4xl text-white font-bold">
            {{ data.reopened.result.percentage }}%
          </p>
        </div>
      </div>
    </app-card>

    <app-card customClass="bg-card2 w-[260px] h-[237px] p-[25px]">
      <div class="h-[25%]">
        <h4 class="text-white font-semibold text-lg">% Performa SLA</h4>
      </div>
      <div class="h-[75%] flex justify-end">
        <div class="flex justify-end items-end">
          <p class="text-end text-4xl text-white font-bold">
            {{ data.sla_performance.result.percentage_sla_performance }}%
          </p>
        </div>
      </div>
    </app-card>

    <app-card
      customClass="w-[380px] lg:w-[540px] h-[237px] p-[25px] flex flex-col gap-[15px]"
    >
      <h4 class="font-semibold text-lg">SLA Tiket Selesai</h4>
      <div class="flex justify-between gap-2">
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#3FAB6C] to-[#65D493] w-[230px] h-[65px] rounded-xl px-[30px] text-white"
        >
          <p class="text-lg">0 < 5 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed["0-5_HK"] }}
          </p>
        </div>
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#F7BB21] to-[#FDCD85] w-[230px] h-[65px] rounded-xl px-[30px] text-white"
        >
          <p class="text-lg">6 < 10 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed["6-10_HK"] }}
          </p>
        </div>
      </div>
      <div class="flex justify-between gap-2">
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#FF8901] to-[#FFB867] w-[230px] h-[65px] rounded-xl px-[30px] text-white"
        >
          <p class="text-lg">11 < 15 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed["11-15_HK"] }}
          </p>
        </div>
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#F55217] to-[#FB7949] w-[230px] h-[65px] rounded-xl px-[30px] text-white"
        >
          <p class="text-lg">> 15 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed[">15_HK"] }}
          </p>
        </div>
      </div>
    </app-card>
  </div>
  } @else {

  <div
    class="flex w-full flex-wrap gap-4 justify-center xl:flex-nowrap xl:justify-between"
  >
    <app-card customClass="bg-card1 w-[200px] h-[237px] p-[25px]">
      <div class="h-[25%]">
        <h4 class="text-white font-semibold text-lg">
          % Laporan Dibuka Kembali
        </h4>
      </div>
      <div class="h-[75%] flex justify-end">
        <div class="flex justify-end items-end">
          <p class="text-end text-4xl text-white font-bold">
            {{ data.reopened.result.percentage }}%
          </p>
        </div>
      </div>
    </app-card>
    <app-card customClass="bg-card2 w-[200px] h-[237px] p-[25px]">
      <div class="h-[25%]">
        <h4 class="text-white font-semibold text-lg">% Performa SLA</h4>
      </div>
      <div class="h-[75%] flex justify-end">
        <div class="flex justify-end items-end">
          <p class="text-end text-4xl text-white font-bold">
            {{ data.sla_performance.result.percentage_sla_performance }}%
          </p>
        </div>
      </div>
    </app-card>
    @if (data.autoclose) {
    <app-card customClass="bg-card3 w-[200px] h-[237px] p-[25px]">
      <div class="h-[25%]">
        <h4 class="text-white font-semibold text-lg">% Tiket Autoclose</h4>
      </div>
      <div class="h-[75%] flex justify-end">
        <div class="flex justify-end items-end">
          <p class="text-end text-4xl text-white font-bold">
            {{ data.autoclose.result.percentage }}%
          </p>
        </div>
      </div>
    </app-card>
    }
    <app-card
      customClass="w-[430px] h-[237px] p-[25px] flex flex-col gap-[15px]"
    >
      <h4 class="font-semibold text-lg">SLA Tiket Selesai</h4>
      <div class="flex justify-between">
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#3FAB6C] to-[#65D493] w-[180px] h-[65px] rounded-xl px-[15px] text-white"
        >
          <p class="text-lg">0 < 5 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed["0-5_HK"] }}
          </p>
        </div>
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#F7BB21] to-[#FDCD85] w-[180px] h-[65px] rounded-xl px-[15px] text-white"
        >
          <p class="text-lg">6 < 10 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed["6-10_HK"] }}
          </p>
        </div>
      </div>
      <div class="flex justify-between">
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#FF8901] to-[#FFB867] w-[180px] h-[65px] rounded-xl px-[15px] text-white"
        >
          <p class="text-lg">11 < 15 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed["11-15_HK"] }}
          </p>
        </div>
        <div
          class="flex justify-between items-center bg-gradient-to-br from-[#F55217] to-[#FB7949] w-[180px] h-[65px] rounded-xl px-[15px] text-white"
        >
          <p class="text-lg">> 15 HK</p>
          <p class="text-2xl font-semibold">
            {{ data.sla_completed.result.sla_completed[">15_HK"] }}
          </p>
        </div>
      </div>
    </app-card>
  </div>
  } } @if (data.total && data.submitted && data.processed && data.completed) {
  <div class="flex justify-center gap-4 xl:justify-between w-full flex-wrap">
    <app-card
      customClass="flex items-center justify-center bg-gradient-to-tl from-[#F37142] to-[#F58961] w-[261px] h-[108px] gap-[59px] text-white"
    >
      <div>
        <p>Total Laporan</p>
        <p class="font-semibold text-[24px]">
          {{ data.total.result.total_reports }}
        </p>
      </div>
      <div>
        <lucide-icon name="clipboard-list" size="48"></lucide-icon>
      </div>
    </app-card>
    <app-card
      customClass="flex items-center justify-center bg-gradient-to-tl from-[#135993] to-[#2096F9] w-[261px] h-[108px] gap-[28px] text-white"
    >
      <div>
        <p>Laporan Diajukan</p>
        <p class="font-semibold text-[24px]">
          {{ data.submitted.result.total_reports }}
        </p>
      </div>
      <div>
        <lucide-icon name="file-input" size="48"></lucide-icon>
      </div>
    </app-card>
    <app-card
      customClass="flex items-center justify-center bg-gradient-to-tl from-[#473B91] to-[#7965F7] w-[261px] h-[108px] gap-[28px] text-white"
    >
      <div>
        <p>Laporan Diproses</p>
        <p class="font-semibold text-[24px]">
          {{ data.processed.result.reports }}
        </p>
      </div>
      <div>
        <lucide-icon name="hourglass" size="48"></lucide-icon>
      </div>
    </app-card>
    <app-card
      customClass="flex items-center justify-center bg-gradient-to-tl from-[#006885] to-[#007DA0] w-[261px] h-[108px] gap-[45px] text-white"
    >
      <div>
        <p>Laporan Selesai</p>
        <p class="font-semibold text-[24px]">
          {{ data.completed.result.reports }}
        </p>
      </div>
      <div>
        <lucide-icon name="file-check-2" size="48"></lucide-icon>
      </div>
    </app-card>
  </div>
  } @if (graphWeekData.category && doughnutData.category && weekLabel.category)
  {
  <div
    class="flex flex-col items-center xl:items-start xl:flex-row gap-[15px] justify-between"
  >
    <app-card customClass="2xl:w-[1200px] lg:w-[840px] h-[420px] p-[25px]">
      <h2 class="text-lg font-medium text-greenPrimary">
        Total Reports By Category
      </h2>
      <div class="w-full flex justify-end gap-4">
        <app-dropdown
          variants="dashboard"
          [text]="filterDropdown.category[0]"
          [dropdownItems]="filterDropdown.category"
          (onDropdownClick)="onHandleLeftGraph('category', 'name', $event)"
        />
        <div class="w-32">
          <app-dropdown
            variants="dashboard"
            [text]="monthDropdown.items[idxDateNow]"
            [dropdownItems]="monthDropdown.items"
            (onDropdownClick)="onHandleLeftGraph('category', 'month', $event)"
          />
        </div>
      </div>

      <div class="lg:h-[300px] mt-4">
        <app-bar-chart
          idChart="categoryChart"
          [labels]="weekLabel.category"
          [data]="graphWeekData.category"
        />
      </div>
    </app-card>
    <app-card customClass="w-[261px] h-[420px] p-[25px]">
      <h2 class="text-lg font-medium text-greenPrimary">
        {{ chosenDropdown.category | toTitleCase }}
      </h2>
      <div class="flex flex-col justify-around h-full w-full">
        <div class="w-full mt-4">
          <app-doughnut-chart
            idChart="categorySecondChart"
            [data]="doughnutData.category"
            [labels]="doughnutLabel.category"
          />
        </div>
        <div class="flex flex-col gap-1 text-sm">
          <div class="flex justify-between">
            <p>{{ chosenDropdown.category | toTitleCase }}</p>
            <p>{{ doughnutData.category[0] }}</p>
          </div>
          <div class="flex justify-between text-neutral300">
            <p>Total Laporan</p>
            <p>{{ doughnutData.category[0] + doughnutData.category[1] }}</p>
          </div>
        </div>
      </div>
    </app-card>
  </div>
  } @if (doughnutData.status && graphWeekData.status && weekLabel.status) {
  <div
    class="flex flex-col items-center xl:items-start xl:flex-row gap-[15px] justify-between"
  >
    <app-card customClass="2xl:w-[1200px] lg:w-[840px] h-[420px] p-[25px]">
      <h2 class="text-lg font-medium text-greenPrimary">
        Total Reports By Status
      </h2>
      <div class="w-full flex justify-end gap-4">
        <div class="w-[150px]">
          <app-dropdown
            variants="dashboard"
            [text]="filterDropdown.status[0]"
            [dropdownItems]="filterDropdown.status"
            (onDropdownClick)="onHandleLeftGraph('status', 'name', $event)"
          />
        </div>
        <div class="w-32">
          <app-dropdown
            variants="dashboard"
            [text]="monthDropdown.items[idxDateNow]"
            [dropdownItems]="monthDropdown.items"
            (onDropdownClick)="onHandleLeftGraph('status', 'month', $event)"
          />
        </div>
      </div>
      @if (weekLabel.category && graphWeekData.category) {
      <div class="lg:h-[300px] mt-4">
        <app-line-chart
          idChart="statusChart"
          legendLabel="Reports by Status"
          [labels]="weekLabel.status"
          [data]="graphWeekData.status"
        />
      </div>
      }
    </app-card>
    <app-card customClass="w-[261px] h-[420px] p-[25px]">
      <h2 class="text-lg font-medium text-greenPrimary">
        {{ chosenDropdown.status | toTitleCase }}
      </h2>
      <div class="flex flex-col justify-around h-full w-full">
        <div class="w-full mt-4">
          <app-doughnut-chart
            idChart="statusSecondChart"
            [data]="doughnutData.status"
            [labels]="doughnutLabel.status"
          />
        </div>
        <div class="flex flex-col gap-1 text-sm">
          <div class="flex justify-between">
            <p>{{ chosenDropdown.status | toTitleCase }}</p>
            <p>{{ doughnutData.status[0] }}</p>
          </div>
          <div class="flex justify-between text-neutral300">
            <p>Total Laporan</p>
            <p>{{ doughnutData.category[0] + doughnutData.category[1] }}</p>
          </div>
        </div>
      </div>
    </app-card>
  </div>
  } @if (doughnutData.rating && graphWeekData.rating && weekLabel.rating) {
  <div
    class="flex flex-col items-center xl:items-start xl:flex-row gap-[15px] justify-between"
  >
    <app-card customClass="2xl:w-[1200px] lg:w-[840px] h-[420px] p-[25px]">
      <h2 class="text-lg font-medium text-greenPrimary">
        Total Reports By Rating
      </h2>
      <div class="w-full flex justify-end gap-4">
        <div class="w-[150px]">
          <app-dropdown
            variants="dashboard"
            [text]="filterDropdown.rating[filterDropdown.rating.length - 1]"
            [dropdownItems]="filterDropdown.rating"
            (onDropdownClick)="onHandleLeftGraph('rating', 'rate', $event)"
          />
        </div>
        <div class="w-32">
          <app-dropdown
            variants="dashboard"
            [text]="monthDropdown.items[idxDateNow]"
            [dropdownItems]="monthDropdown.items"
            (onDropdownClick)="onHandleLeftGraph('rating', 'month', $event)"
          />
        </div>
      </div>
      @if (weekLabel.category && graphWeekData.category) {
      <div class="lg:h-[300px] mt-4">
        <app-line-chart
          idChart="ratingChart"
          legendLabel="Reports by Rating"
          [labels]="weekLabel.rating"
          [data]="graphWeekData.rating"
        />
      </div>
      }
    </app-card>
    <app-card customClass="w-[261px] h-[420px] p-[25px]">
      <h2 class="text-lg font-medium text-greenPrimary">
        {{ chosenDropdown.rating | toTitleCase }} Bintang
      </h2>
      <div class="flex flex-col justify-around h-full w-full">
        <div class="w-full mt-4">
          <app-doughnut-chart
            idChart="ratingSecondChart"
            [data]="doughnutData.rating"
            [labels]="doughnutLabel.rating"
          />
        </div>
        <div class="flex flex-col gap-1 text-sm">
          <div class="flex justify-between">
            <p>{{ chosenDropdown.rating | toTitleCase }} Bintang</p>
            <p>{{ doughnutData.rating[0] }}</p>
          </div>
          <div class="flex justify-between text-neutral300">
            <p>Total Laporan</p>
            <p>{{ doughnutData.rating[0] + doughnutData.rating[1] }}</p>
          </div>
        </div>
      </div>
    </app-card>
  </div>
  }
</div>
